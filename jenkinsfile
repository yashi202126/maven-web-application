 pipeline {

    agent any

    tools {

        maven "MAVEN"

    }

    environment {

        TAG = "${BUILD_NUMBER}"
    }

    stages {

        stage('git-Clone') {

            steps {

                git credentialsId: 'github', url: 'https://github.com/yashi202126/maven-web-application'

            }

        }

        stage('Build the package') {

            steps {

                sh "mvn clean package"

            }

        }

        stage('Build Docker Image') {

            steps {

                sh "docker build -t purudocker12/mavenwebapp111:${TAG} ."

            }

        }

        stage('Push Docker image to Docker Hub registry') {

            steps {

                withCredentials([string(credentialsId: 'DOCKER_HUB_PASSWORD', variable: 'DOCKER_HUB_PASSWORD')]) {

                    sh "docker login -u purudocker12 -p ${DOCKER_HUB_PASSWORD}"

                    sh "docker push purudocker12/mavenwebapp111:${TAG}"
                    sh "docker run -d --name mavenwebapp-container -p 8080:8080 purudocker12/mavenwebapp111:${TAG}"
                }

            }

        }

        

    post {

        success {

            echo 'Pipeline completed successfully!'

        }

        failure {

            echo 'Pipeline failed !'

        }

    }
 }
}
 
